p.facet <- ggplot() +
geom_tile(
data = data.raster,
mapping = aes(x = year, y = forecast, fill = density)
) +
scale_fill_gradient(name = "Probability density\n(normalised)",
low = "white", high = base_color) +
geom_line(
data = data.plot.random,
mapping = aes(
x = year,
y = forecast,
group = sample,
color = "Example path"
),
lwd = 0.5,
alpha = 0.5
) +
scale_color_manual(
values = c("Example path" = "grey"),
name = NULL,
guide = guide_legend(order = 3)
) +
new_scale_color() +
geom_line(
data = data.stat,
mapping = aes(x = year, y = x, color = q),
size = 1
) +
scale_color_manual(values = col.quant,
name = "Percentiles",
labels = c("0.95" = "95 %",
"0.9" = "90 %",
"0.5" = "50 % (Median)",
"0.1" = "10 %",
"0.05" = "5 %"),
guide = guide_legend(order = 4)) +
new_scale_color() +
xlab("year") +
scale_x_continuous(
breaks = seq(2030, 2050, by = 5)
) +
ylab(expression("DAC Capacity [GtCO"[2]*"/a]")) +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
) +
ggtitle(title) +
theme(
legend.position = c(0.1, 0.9),
legend.justification = c(0, 1),
legend.background = element_rect(fill = alpha("white", 0.7), color = NA),
plot.title = element_text(face = "bold", size = font.size)
)
# Optional zoom panel
if (zoom.panel == T) {
p.facet <- p.facet +
facet_zoom(
xlim = c(t.split, t.max),
ylim = c(0, max(data.plot.demand$demand_mean)),
horizontal = FALSE,
zoom.size = 0.5,
show.area = FALSE
)
}
p.plot <- p.facet
return(p.plot)
}
# Adaptation of the plotProbabilisticFeasibilitySpace_with_base_median function
plotProbabilisticFeasibilitySpace_with_base_median <- function(data.row,
dac_target_base,
dac_target_policy,
colour_index,
plot.marginal = T,
marginal.year,
title,
ci.80 = F,
slices = 500,
random.paths = 10,
base_case_median,
show_LNG_wind_medians = TRUE,
LNG_data_stat = NULL,
wind_data_stat = NULL,
text_offset = 0.1,
text_offset_LNG = -0.1,
text_offset_wind = 0.2,
zoom.panel = F,
round_to_tens = TRUE) {
# Prepare data
data.plot <- data.row %>%
unnest(sensitivities) %>%
select(!demand) %>%
unnest(results)
# Select base color for the plot
base_color <- colours[colour_index]
# Calculate median and percentiles
if (ci.80 == T) {
quantiles <- c(0.95, 0.9, 0.5, 0.1, 0.05)
col.quant <- c("0.95" = lighten(base_color, 0.3),
"0.9" = lighten(base_color, 0.2),
"0.5" = darken(base_color, 0.3),
"0.1" = darken(base_color, 0.15),
"0.05" = base_color)
} else {
quantiles <- c(0.95, 0.5, 0.05)
col.quant <- c("0.95" = lighten(base_color, 0.3),
"0.5" = darken(base_color, 0.3),
"0.05" = base_color)
}
quibble <- function(x, q = quantiles) {
tibble(x = quantile(x, q), q = q)
}
data.stat <- data.plot %>%
group_by(year) %>%
reframe(quibble(forecast)) %>%
mutate(q = as.factor(q))
# Receive demand
data.plot.demand <- data.plot %>%
filter(sample == 1)
# Select random paths
data.plot.random <- data.plot %>%
filter(sample %in% sample(1:max(data.plot$sample), random.paths))
# Calculate the density of scenarios for each year and save in grid
data.raster <- NULL
for (y in unique(data.plot$year)) {
subset <- data.plot %>%
filter(year == y) %>%
pull(forecast)
dens <- density(
subset,
n = slices,
na.rm = T,
from = 0,
to = max(data.plot.demand$demand, na.rm = T)
)
dens$y <- dens$y / max(dens$y)
temp <- tibble(year = y,
forecast = dens$x,
density = dens$y)
data.raster <- bind_rows(data.raster, temp)
}
# Create the plot
p.facet <- ggplot() +
geom_raster(
data = data.raster,
mapping = aes(x = year, y = forecast, fill = density),
interpolate = TRUE
) +
scale_fill_gradient(name = "Probability density\n(normalised)",
low = "white", high = base_color) +
geom_line(
data = data.plot.random,
mapping = aes(
x = year,
y = forecast,
group = sample,
color = "Example path"
),
lwd = 0.5,
alpha = 0.5
) +
scale_color_manual(
values = c("Example path" = "grey"),
name = NULL,
guide = guide_legend(order = 3)
) +
new_scale_color() +
geom_line(
data = data.stat,
mapping = aes(x = year, y = x, color = q),
size = 1
) +
scale_color_manual(values = col.quant,
name = "Percentiles",
labels = c("0.95" = "95 %",
"0.9" = "90 %",
"0.5" = "50 % (Median)",
"0.1" = "10 %",
"0.05" = "5 %"),
guide = guide_legend(order = 4)) +
new_scale_color() +
# Median A) Base Case hinzufügen
geom_line(
data = base_case_median,
aes(x = year, y = x),
linetype = "dotted",
color = "#E64B35FF",
size = 0.8
) +
xlab("year") +
scale_x_continuous(
breaks = seq(2030, 2050, by = 5)
) +
ylab(expression("DAC Capacity [GtCO"[2]*"/a]")) +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
) +
ggtitle(title) +
theme(
legend.position = c(0.1, 0.9),
legend.justification = c(0, 1),
legend.background = element_rect(fill = alpha("white", 0.7), color = NA),
plot.title = element_text(face = "bold", size = font.size)
)
# Show LNG/Wind medians only if activated
if (show_LNG_wind_medians) {
# Add LNG median
p.facet <- p.facet +
geom_line(
data = LNG_data_stat,
aes(x = year, y = x),
linetype = "dashed",
color = "#00A087FF",
size = 0.8
)
# Add wind energy median
p.facet <- p.facet +
geom_line(
data = wind_data_stat,
aes(x = year, y = x),
linetype = "dashed",
color = "blue",
size = 0.8
)
}
# Optional zoom panel
if (zoom.panel == T) {
p.facet <- p.facet +
facet_zoom(
xlim = c(t.split, 2030),
ylim = c(0, data.plot.targets %>% filter(year == 2030) %>% pull(value)),
horizontal = FALSE,
zoom.size = 0.5,
show.area = FALSE
)
}
p.plot <- p.facet
# Calculation of the percentage deviation between median of the base case and
#the median of the current curve
base_median_value <- base_case_median %>% filter(year == marginal.year) %>% pull(x)
current_median_value <- data.stat %>% filter(q == 0.5, year == marginal.year) %>% pull(x)
percentage_difference <- ((current_median_value - base_median_value)
/ base_median_value) * 100
# Apply rounding to 10s or 1s depending on the parameter
round_digits <- ifelse(round_to_tens, -1, 0)
# Add text to display the percentage deviation
p.plot <- p.plot +
annotate("text", x = max(data.stat$year) + 1,
y = min(current_median_value + text_offset * current_median_value, 2000),
label = paste0("~ ", format(round(percentage_difference, round_digits),
nsmall = 0), " % ∆"),# Dynamische Rundung
hjust = 1, size = 3, color = "#E64B35FF")
# Calculation and annotation for LNG median deviation
if (show_LNG_wind_medians && !is.null(LNG_data_stat)) {
LNG_median_value <- LNG_data_stat %>% filter(year == marginal.year) %>% pull(x)
LNG_percentage_difference <-
((LNG_median_value - base_median_value) / base_median_value) * 100
p.plot <- p.plot +
annotate("text", x = max(data.stat$year) + 1,
y = min(current_median_value + text_offset * current_median_value, 2100),
label = paste0("~ ", format(round(LNG_percentage_difference, round_digits),
nsmall = 0), " % ∆ LNG"),  # Dynamische Rundung
hjust = 1, size = 3, color = "#00A087FF")
}
# Calculation and annotation for wind energy median deviation
if (show_LNG_wind_medians && !is.null(wind_data_stat)) {
wind_median_value <- wind_data_stat %>% filter(year == marginal.year) %>% pull(x)
wind_percentage_difference <-
((wind_median_value - base_median_value) / base_median_value) * 100
p.plot <- p.plot +
annotate("text", x = max(data.stat$year) + 1,
y = min(current_median_value + text_offset * current_median_value, 2200),
label = paste0("~ ", format(round(wind_percentage_difference, round_digits),
nsmall = 0), " % ∆ Wind"),  # Dynamische Rundung
hjust = 1, size = 3, color = "blue")
}
# Legend for all lines
if (show_LNG_wind_medians) {
p.plot <- p.plot +
scale_color_manual(
values = c(
"Base case median" = "#E64B35FF",
"LNG median" = "#00A087FF",
"Wind median" = "blue"
),
labels = c(
"Base case median" = "Base case median",
"LNG median" = "LNG median",
"Wind median" = "Wind median"
),
name = "Medians"
) +
guides(
color = guide_legend(
override.aes = list(
linetype = c("dotted", "dashed", "dashed"),
color = c("#E64B35FF", "#00A087FF", "blue")
),
order = 5
)
)
}
return(p.plot)
}
# A) Base case
p_base_case_ammonia <- plotProbabilisticFeasibilitySpace(
data.row = data.results.ammonia.base %>%
filter(region == "Global", anticipation == 5),
dac_target_base = dac_target_base,
colour_index = 5,
title = "Base case — Ammonia Synthesis")
p_base_case_naturalgas <- plotProbabilisticFeasibilitySpace(
data.row = data.results.naturalgas.base %>%
filter(region == "Global", anticipation == 5),
dac_target_base = dac_target_base,
colour_index = 3,
title = "Base case — LNG")
p_base_case_wind <- plotProbabilisticFeasibilitySpace(
data.row = data.results.wind.base %>%
filter(region == "Global", anticipation == 5),
dac_target_base = dac_target_base,
colour_index = 2,   # dieser Wert wird zwar übergeben
title = "Base case — Wind"
) + scale_fill_gradient(low = "white", high = "blue") +
scale_color_manual(values = c("0.95" = lighten("blue", 0.3),
"0.5" = darken("blue", 0.3),
"0.05" = "blue"),
name = "Percentiles",
labels = c("0.95" = "95 %",
"0.5" = "50 % (Median)",
"0.05" = "5 %"))
#p_base_case <- plotProbabilisticFeasibilitySpace(
#  data.row = data.results %>%
#    filter(region == "Global", anticipation == 5),
#  dac_target_base = dac_target_base,
#  colour_index = 5,
#  title = "Base case"
#)
# Median of the base case
base_case_median <- data.results.ammonia.base %>%
filter(region == "Global", anticipation == 5) %>%
unnest(sensitivities) %>%
select(!demand) %>%
unnest(results) %>%
group_by(year) %>%
summarise(x = quantile(forecast, 0.5))  # Calculate median (50% quantile)
base_case_median <- as.data.frame(base_case_median)
# B) With technology policy
p_policy_case_with_median <- plotProbabilisticFeasibilitySpace_with_base_median(
data.row = data.results.policy %>%
filter(region == "Global", anticipation == 15),
dac_target_base = dac_target_base,
dac_target_policy = dac_target_policy,
colour_index = 2,
marginal.year = 2045,
title = "With technology policy",
base_case_median = base_case_median,
show_LNG_wind_medians = TRUE,  # Show LNG/Wind median
LNG_data_stat = LNG_data_stat,  # LNG median data
wind_data_stat = wind_data_stat,  # Wind median data
text_offset = 30,
text_offset_LNG = 0.7,
text_offset_wind = 0.9
)
# i) Policy push fostering short-term DAC capacity (in 2030)
p_policy_push_with_median <- plotProbabilisticFeasibilitySpace_with_base_median(
data.row = data.results.capacity %>%
filter(region == "Global", anticipation == 5),
dac_target_base = dac_target_base,
dac_target_policy = dac_target_policy,
colour_index = 6,
marginal.year = 2045,
title = "policy push fostering short-term DAC\n capacity (in 2030)",
base_case_median = base_case_median,
show_LNG_wind_medians = FALSE,  # Do not show additional medians
text_offset = 10
)
# ii) Creating credibility in long-term DAC requirements
p_demand_pull_anticipation_with_median <-
plotProbabilisticFeasibilitySpace_with_base_median(
data.row = data.results.anticipation %>%
filter(region == "Global", anticipation == 15),
dac_target_base = dac_target_base,
dac_target_policy = dac_target_policy,
colour_index = 6,
marginal.year = 2045,
title = "creating credibility in long-term\n DAC requirements",
base_case_median = base_case_median,
show_LNG_wind_medians = FALSE,  # Do not show additional medians
text_offset = 30,
round_to_tens = FALSE
)
# iii) Securing minimum long-term DAC demand
p_demand_pull_ltm_with_median <- plotProbabilisticFeasibilitySpace_with_base_median(
data.row = data.results.longterm %>%
filter(region == "Global", anticipation == 5),
dac_target_base = dac_target_base,
dac_target_policy = dac_target_policy,
colour_index = 6,
marginal.year = 2045,
title = "securing minimum long-term DAC demand",
base_case_median = base_case_median,
show_LNG_wind_medians = FALSE,  # Do not show additional medians
text_offset = 30,
round_to_tens = FALSE
)
# Adjustment of the y-axis
# A) Global Base Case
p_base_case <- p_base_case_ammonia +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
p_base_case <- p_base_case_naturalgas +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
p_base_case <- p_base_case_wind +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
# B) Global Policy Case
p_policy_case_with_median <- p_policy_case_with_median +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
# i) Policy Push: Short-term Capacity
p_policy_push_with_median <- p_policy_push_with_median +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
# ii) Demand Pull: Anticipation
p_demand_pull_anticipation_with_median <- p_demand_pull_anticipation_with_median +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
# iii) Demand Pull: Long-term Market Growth
p_demand_pull_ltm_with_median <- p_demand_pull_ltm_with_median +
scale_y_continuous(
labels = scales::label_number(scale = 1e-3),
expand = expansion(mult = c(0.01, 0.05)),
limits = c(0, 1800),
breaks = seq(0, 1800, by = 250)
)
# Merging the plots into the layout
# A) erste Reihe: A-i und A-ii
A_row_top <- plot_grid(
p_base_case_ammonia, p_base_case_naturalgas,
ncol = 2,
labels = c("A-i", "A-ii"),
label_size = 10
)
# A) + B) zweite Reihe: A-iii und B
A_row_bottom <- plot_grid(
p_base_case_wind, p_policy_case_with_median,
ncol = 2,
labels = c("A-iii", "B"),
label_size = 10
)
# Kombiniere obere und untere Zeile
upper_plot <- plot_grid(
A_row_top,
A_row_bottom,
ncol = 1,
rel_heights = c(1, 1)
)
# Titel
title <- ggdraw() +
draw_label(
"Global DAC Capacity in 2050",
fontface = 'bold',
size = 12,
hjust = 0.5,
vjust = 0.1
)
# Endplot
final_plot <- plot_grid(
title,
upper_plot,
ncol = 1,
rel_heights = c(0.1, 2)
)
print(final_plot)
# Speichern
ggsave(paste0(path.output, "VISUAL_1.1_Probabilistic_Feasibility_Space_AMMONIA.png"),
plot = final_plot,
width = 30, height = 32, units = "cm", bg = "white")
ggsave(paste0(path.output, "VISUAL_1.1_Probabilistic_Feasibility_Space_AMMONIA.pdf"),
plot = final_plot,
width = 30, height = 32, units = "cm", bg = "white")
